<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>学生成绩信息管理系统</title>

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/dashboard.css" rel="stylesheet">
    <style type="text/css">
        /* Chart.js */
        @-webkit-keyframes chartjs-render-animation {
            from { opacity: 0.99; }
            to { opacity: 1; }
        }

        @keyframes chartjs-render-animation {
            from { opacity: 0.99; }
            to { opacity: 1; }
        }

        .chartjs-render-monitor {
            -webkit-animation: chartjs-render-animation 0.001s;
            animation: chartjs-render-animation 0.001s;
        }

        .custom-bg-color {
            background-color: #f8f9fa;
        }

        .sidebar {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            z-index: 100;
            padding: 48px 0 0;
            box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
        }

        .sidebar-sticky {
            position: relative;
            top: 0;
            height: calc(100vh - 48px);
            padding-top: .5rem;
            overflow-x: hidden;
            overflow-y: auto;
        }

        .table {
            font-size: 16px;
        }

        .table th {
            font-size: 16px;
            font-weight: 500;
        }

        .btn {
            font-size: 14px;
        }
    </style>
</head>

<body>
<!-- Static Topbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
    <a class="navbar-brand" href="#">学生成绩信息管理系统</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
                <a class="nav-link" href="#">首页 <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item text-nowrap">
                <a class="nav-link" href="/login.html">注销</a>
            </li>
        </ul>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <!-- Static Sidebar -->
        <nav class="col-md-2 d-none d-md-block bg-light sidebar">
            <div class="sidebar-sticky">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="../commons/admbar.html">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                            首页
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../adm/stubyid.html">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                            学生管理
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../adm/teabyid.html">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                            教师管理
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="../adm/classbyid.html">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                            班级管理
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main content -->
        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4" style="margin-top: 50px;">
            <h2>班级管理
                <a class="btn btn-info" href="addclass.html">班级添加</a>
                <button style="float: right" class="btn btn-outline-secondary" onclick="loadAllClasses()">查询所有班级</button>
            </h2>

            <div class="form-group mt-3">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" id="searchInput" placeholder="请输入班级名" aria-label="请输入班级名">
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button" onclick="searchClasses()">查询</button>
                    </div>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>班级编号</th>
                        <th>班级名称</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody id="classTableBody">
                    <!-- 数据将在这里渲染 -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>
</div>

<!-- Bootstrap core JavaScript -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"></script>

<!-- 添加 axios -->
<script src="../js/axios.min.js"></script>
<script src="../js/axiosConfig.js"></script>
<!-- Custom JavaScript -->
<script>
    // 页面加载完成后执行
    document.addEventListener('DOMContentLoaded', function() {
        loadAllClasses();
    });

    // 加载所有班级
    function loadAllClasses() {
        fetch('/Class/getAllClasses')
            .then(response => response.json())
            .then(result => {
                console.log('接收到的完整响应:', result);
                if (result.code === 200) {
                    renderTable(result.data);
                } else {
                    showEmptyMessage(result.message || '暂无班级信息');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showEmptyMessage('加载失败，请刷新页面重试');
            });
    }

    // 渲染表格
    function renderTable(classes) {
        console.log('准备渲染的数据:', classes);
        const tbody = document.getElementById('classTableBody');
        tbody.innerHTML = '';

        if (!classes || classes.length === 0) {
            showEmptyMessage('暂无班级信息');
            return;
        }

        classes.forEach(classItem => {
            const row = document.createElement('tr');
            row.innerHTML = `
            <td>${classItem.classId || ''}</td>
            <td>${classItem.className || ''}</td>
            <td>
                <button class="btn btn-primary" onclick="editClass('${classItem.classId}')">编辑</button>
                <button class="btn btn-danger" onclick="deleteClass('${classItem.classId}')">删除</button>
            </td>
        `;
            tbody.appendChild(row);
        });
    }

    // 显示空消息
    function showEmptyMessage(message) {
        const tbody = document.getElementById('classTableBody');
        tbody.innerHTML = `<tr><td colspan="3" class="text-center">${message}</td></tr>`;
    }

    // 搜索班级
    function searchClasses() {
        const searchInput = document.getElementById('searchInput');
        const searchText = searchInput.value.trim();

        if (!searchText) {
            loadAllClasses();
            return;
        }

        fetch(`/Class/getClassByName?className=${encodeURIComponent(searchText)}`)
            .then(response => response.json())
            .then(result => {
                console.log('搜索结果:', result);
                if (result.code === 200) {
                    renderTable(result.data);
                } else {
                    showEmptyMessage(result.message || '未找到相关班级');
                }
            })
            .catch(error => {
                console.error('搜索错误:', error);
                showEmptyMessage('搜索失败，请重试');
            });
    }

    // 编辑班级
    function editClass(classId) {
        console.log('编辑班级:', classId);
        window.location.href = "/adm/upadteclass.html";
    }

    // 删除班级
    function deleteClass(classId) {
        if (confirm('确定要删除这个班级吗？')) {
            axios({
                url: `/Class/deleteClass/${classId}`,
                method: "delete"
            }).then(result => {
                if (result.data.code === 200) {
                    // 显示成功消息
                    alert('删除成功！');
                    // 重新加载班级列表
                    loadAllClasses();
                } else {
                    alert(result.data.msg || '删除失败！');
                }
            }).catch(error => {
                console.error('删除失败:', error);
                alert('系统错误，请稍后重试');
            });
        }
    }

    // 添加回车搜索功能
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            searchClasses();
        }
    });
</script>

</body>
</html>